<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wings Fly - Debug Page</title>
    <style>
        body { font-family: monospace; background: #0a0e27; color: #00fff5; padding: 20px; }
        .ok { color: #00ff88; }
        .fail { color: #ff4444; }
        .warn { color: #ffaa00; }
        .box { border: 1px solid #00d9ff; padding: 15px; margin: 10px 0; border-radius: 8px; }
        h2 { color: #b537f2; }
        button { background: #00d9ff; color: #0a0e27; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; margin: 5px; }
        #log { background: #111; padding: 10px; border-radius: 5px; max-height: 400px; overflow-y: auto; font-size: 12px; }
    </style>
</head>
<body>
    <h1>üîß Wings Fly - Login Debug Tool</h1>
    <p>‡¶è‡¶á ‡¶™‡ßá‡¶ú‡¶ü‡¶ø GitHub ‡¶è upload ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶§‡¶æ‡¶∞‡¶™‡¶∞ open ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§</p>

    <div class="box">
        <h2>üìÇ Step 1: ‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶ö‡ßá‡¶ï</h2>
        <div id="fileCheck">‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶õ‡¶ø...</div>
    </div>

    <div class="box">
        <h2>üîê Step 2: Login Test</h2>
        <input type="text" id="testUser" value="admin" style="padding:8px; margin:5px; border-radius:4px; border:none;">
        <input type="password" id="testPass" value="admin123" style="padding:8px; margin:5px; border-radius:4px; border:none;">
        <button onclick="testLogin()">Login Test ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <div id="loginResult" style="margin-top:10px;"></div>
    </div>

    <div class="box">
        <h2>üåê Step 3: Supabase Connection</h2>
        <button onclick="testSupabase()">Supabase Test ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <div id="supabaseResult" style="margin-top:10px;"></div>
    </div>

    <div class="box">
        <h2>üìã Console Log</h2>
        <div id="log"></div>
    </div>

    <!-- Load your actual scripts -->
    <script src="supabase-config.js"></script>
    <script src="supabase-sync-SMART-V26.js"></script>
    <script src="app.js?v=12.0"></script>

    <script>
        // Override console to capture logs
        const logDiv = document.getElementById('log');
        const origLog = console.log;
        const origError = console.error;
        const origWarn = console.warn;

        function addLog(msg, type='log') {
            const colors = { log: '#00fff5', error: '#ff4444', warn: '#ffaa00' };
            logDiv.innerHTML += `<div style="color:${colors[type]}">[${type.toUpperCase()}] ${msg}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        console.log = function(...args) { addLog(args.join(' '), 'log'); origLog(...args); };
        console.error = function(...args) { addLog(args.join(' '), 'error'); origError(...args); };
        console.warn = function(...args) { addLog(args.join(' '), 'warn'); origWarn(...args); };

        window.onerror = function(msg, src, line, col, err) {
            addLog(`‚ùå JS ERROR: ${msg} | File: ${src} | Line: ${line}`, 'error');
        };

        // Step 1: File Check
        window.addEventListener('load', function() {
            const checks = [
                { name: 'supabase-config.js', check: () => typeof window.SUPABASE_CONFIG !== 'undefined' },
                { name: 'app.js (handleLogin)', check: () => typeof window.handleLogin === 'function' },
                { name: 'app.js (globalData)', check: () => typeof window.globalData !== 'undefined' },
                { name: 'supabase-sync (window.supabase)', check: () => typeof window.supabase !== 'undefined' },
            ];

            let html = '';
            checks.forEach(c => {
                try {
                    const ok = c.check();
                    html += `<div class="${ok ? 'ok' : 'fail'}">${ok ? '‚úÖ' : '‚ùå'} ${c.name}: ${ok ? 'LOADED' : 'NOT FOUND'}</div>`;
                } catch(e) {
                    html += `<div class="fail">‚ùå ${c.name}: ERROR - ${e.message}</div>`;
                }
            });
            document.getElementById('fileCheck').innerHTML = html;
        });

        // Step 2: Login Test
        function testLogin() {
            const user = document.getElementById('testUser').value;
            const pass = document.getElementById('testPass').value;
            const result = document.getElementById('loginResult');

            try {
                if (!window.globalData) {
                    result.innerHTML = '<span class="fail">‚ùå globalData ‡¶®‡ßá‡¶á! app.js ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§</span>';
                    return;
                }

                const users = window.globalData.users || [];
                addLog(`Users in globalData: ${JSON.stringify(users.map(u => u.username))}`);

                // Check direct match
                const found = users.find(u => u.username === user && u.password === pass);
                // Check fallback
                const fallback = (user === 'admin' && (pass === 'admin123' || pass === '11108022ashu'));

                if (found || fallback) {
                    result.innerHTML = `<span class="ok">‚úÖ Login ‡¶∏‡¶´‡¶≤ ‡¶π‡¶¨‡ßá! User: ${found ? found.name : 'Super Admin (fallback)'}</span>`;
                } else {
                    result.innerHTML = `<span class="fail">‚ùå Login ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶¨‡ßá‡•§ Username/Password ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ‡•§<br>globalData.users count: ${users.length}</span>`;
                }
            } catch(e) {
                result.innerHTML = `<span class="fail">‚ùå Error: ${e.message}</span>`;
            }
        }

        // Step 3: Supabase Test
        async function testSupabase() {
            const result = document.getElementById('supabaseResult');
            result.innerHTML = '<span class="warn">‚è≥ ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶õ‡¶ø...</span>';

            try {
                if (!window.SUPABASE_CONFIG) {
                    result.innerHTML = '<span class="fail">‚ùå SUPABASE_CONFIG ‡¶®‡ßá‡¶á‡•§ supabase-config.js ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§</span>';
                    return;
                }

                const { createClient } = window.supabase || {};
                if (!createClient) {
                    result.innerHTML = '<span class="fail">‚ùå Supabase client library ‡¶®‡ßá‡¶á‡•§</span>';
                    return;
                }

                const client = createClient(window.SUPABASE_CONFIG.url, window.SUPABASE_CONFIG.anonKey);
                const { data, error } = await client.from('students').select('count').limit(1);

                if (error) {
                    result.innerHTML = `<span class="warn">‚ö†Ô∏è Supabase connected ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ error: ${error.message}<br>(‡¶è‡¶ü‡¶æ ‡¶∏‡ßç‡¶¨‡¶æ‡¶≠‡¶æ‡¶¨‡¶ø‡¶ï ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá ‡¶Ø‡¶¶‡¶ø table ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá)</span>`;
                } else {
                    result.innerHTML = '<span class="ok">‚úÖ Supabase ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶∏‡¶´‡¶≤!</span>';
                }
            } catch(e) {
                result.innerHTML = `<span class="fail">‚ùå Supabase Error: ${e.message}</span>`;
            }
        }
    </script>
</body>
</html>
