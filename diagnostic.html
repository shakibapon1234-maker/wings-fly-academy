<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wings Fly ‚Äî System Diagnostic</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Rajdhani:wght@400;600;700&display=swap');

  :root {
    --bg: #080c18;
    --surface: #0e1428;
    --border: rgba(0,217,255,0.15);
    --cyan: #00d9ff;
    --green: #00ff88;
    --red: #ff4466;
    --yellow: #ffcc00;
    --purple: #b537f2;
    --text: #c0d0e0;
    --mono: 'JetBrains Mono', monospace;
    --heading: 'Rajdhani', sans-serif;
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--mono);
    font-size: 13px;
    min-height: 100vh;
    padding: 24px;
  }

  .header {
    text-align: center;
    margin-bottom: 32px;
  }
  .header h1 {
    font-family: var(--heading);
    font-size: 2rem;
    font-weight: 700;
    color: var(--cyan);
    letter-spacing: 2px;
    text-shadow: 0 0 20px rgba(0,217,255,0.4);
  }
  .header p {
    color: #667;
    margin-top: 6px;
    font-size: 11px;
    letter-spacing: 1px;
  }

  .run-btn {
    display: block;
    margin: 0 auto 28px;
    padding: 12px 40px;
    background: linear-gradient(135deg, var(--cyan), #0088aa);
    color: #000;
    font-family: var(--heading);
    font-size: 1.1rem;
    font-weight: 700;
    letter-spacing: 2px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 0 20px rgba(0,217,255,0.3);
  }
  .run-btn:hover { transform: translateY(-2px); box-shadow: 0 0 30px rgba(0,217,255,0.5); }
  .run-btn:active { transform: translateY(0); }

  .summary-bar {
    display: flex;
    gap: 16px;
    justify-content: center;
    margin-bottom: 24px;
    flex-wrap: wrap;
  }
  .summary-item {
    padding: 10px 20px;
    border-radius: 8px;
    font-family: var(--heading);
    font-size: 1rem;
    font-weight: 700;
    border: 1px solid;
  }
  .summary-pass { background: rgba(0,255,136,0.1); color: var(--green); border-color: rgba(0,255,136,0.3); }
  .summary-fail { background: rgba(255,68,102,0.1); color: var(--red); border-color: rgba(255,68,102,0.3); }
  .summary-warn { background: rgba(255,204,0,0.1); color: var(--yellow); border-color: rgba(255,204,0,0.3); }

  .section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 16px;
    overflow: hidden;
  }
  .section-header {
    padding: 12px 18px;
    background: rgba(0,217,255,0.05);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    user-select: none;
  }
  .section-header:hover { background: rgba(0,217,255,0.08); }
  .section-title {
    font-family: var(--heading);
    font-size: 1rem;
    font-weight: 700;
    color: var(--cyan);
    letter-spacing: 1px;
  }
  .section-score {
    font-size: 11px;
    color: #667;
  }
  .section-body { padding: 0; }
  .section-body.collapsed { display: none; }

  .test-row {
    display: grid;
    grid-template-columns: 1fr 2fr auto;
    gap: 12px;
    align-items: center;
    padding: 10px 18px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    transition: background 0.15s;
  }
  .test-row:last-child { border-bottom: none; }
  .test-row:hover { background: rgba(255,255,255,0.02); }

  .test-name { color: var(--cyan); font-weight: 600; }
  .test-desc { color: #667; font-size: 11px; }
  .badge {
    padding: 3px 10px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 1px;
    white-space: nowrap;
  }
  .pass { background: rgba(0,255,136,0.15); color: var(--green); border: 1px solid rgba(0,255,136,0.3); }
  .fail { background: rgba(255,68,102,0.15); color: var(--red); border: 1px solid rgba(255,68,102,0.3); }
  .warn { background: rgba(255,204,0,0.15); color: var(--yellow); border: 1px solid rgba(255,204,0,0.3); }
  .skip { background: rgba(100,100,100,0.15); color: #667; border: 1px solid rgba(100,100,100,0.2); }
  .running { background: rgba(0,217,255,0.1); color: var(--cyan); border: 1px solid rgba(0,217,255,0.3); animation: pulse 1s infinite; }

  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.5} }

  .error-detail {
    grid-column: 1 / -1;
    background: rgba(255,68,102,0.05);
    border: 1px solid rgba(255,68,102,0.2);
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 11px;
    color: var(--red);
    margin-top: 4px;
    display: none;
  }
  .error-detail.visible { display: block; }

  .data-preview {
    grid-column: 1 / -1;
    background: rgba(0,0,0,0.3);
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 11px;
    color: #8899aa;
    margin-top: 4px;
    display: none;
    word-break: break-all;
  }
  .data-preview.visible { display: block; }

  .log-area {
    background: #050810;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 16px;
    max-height: 200px;
    overflow-y: auto;
    font-size: 11px;
    color: #556;
    margin-top: 16px;
  }
  .log-line { margin-bottom: 4px; }
  .log-ok { color: var(--green); }
  .log-err { color: var(--red); }
  .log-warn { color: var(--yellow); }
  .log-info { color: var(--cyan); }

  .app-url-bar {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    align-items: center;
  }
  .app-url-bar input {
    flex: 1;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 8px 12px;
    color: var(--cyan);
    font-family: var(--mono);
    font-size: 12px;
    outline: none;
  }
  .app-url-bar input:focus { border-color: var(--cyan); }
  .app-url-bar button {
    padding: 8px 16px;
    background: rgba(0,217,255,0.1);
    border: 1px solid var(--cyan);
    color: var(--cyan);
    border-radius: 6px;
    cursor: pointer;
    font-family: var(--mono);
    font-size: 12px;
  }

  #results { display: none; }
</style>
</head>
<body>

<div class="header">
  <h1>‚ö° WINGS FLY ‚Äî SYSTEM DIAGNOSTIC</h1>
  <p>‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ function ‡¶ì feature ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï‡ßá</p>
</div>

<div class="app-url-bar">
  <input type="text" id="appUrl" value="https://shakibapon1234-maker.github.io/wings-fly-academy/" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ app URL ‡¶¶‡¶ø‡¶®...">
  <button onclick="openApp()">üîó App ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®</button>
</div>

<button class="run-btn" onclick="runAllTests()">‚ñ∂ RUN ALL TESTS</button>

<div id="results">
  <div class="summary-bar" id="summaryBar"></div>
  <div id="sectionsContainer"></div>
  <div class="log-area" id="logArea"></div>
</div>

<script>
const APP_KEY = 'wingsfly_data';
const SNAPSHOT_KEY = 'wingsfly_snapshots';

let logs = [];
let passCount = 0, failCount = 0, warnCount = 0;

function openApp() {
  window.open(document.getElementById('appUrl').value, '_blank');
}

function log(type, msg) {
  logs.push({ type, msg });
  const el = document.getElementById('logArea');
  const line = document.createElement('div');
  line.className = `log-line log-${type}`;
  line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
  el.appendChild(line);
  el.scrollTop = el.scrollHeight;
}

function getAppData() {
  try {
    const raw = localStorage.getItem(APP_KEY);
    if (!raw) return null;
    return JSON.parse(raw);
  } catch(e) { return null; }
}

// ‚îÄ‚îÄ‚îÄ TEST DEFINITIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const TEST_SECTIONS = [
  {
    title: 'üíæ LocalStorage & Data',
    tests: [
      {
        name: 'wingsfly_data exists',
        desc: 'localStorage-‡¶è main data ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ',
        run: () => {
          const raw = localStorage.getItem(APP_KEY);
          if (!raw) return { status:'fail', detail:'localStorage-‡¶è ‡¶ï‡ßã‡¶®‡ßã data ‡¶®‡ßá‡¶á‡•§ App-‡¶è login ‡¶ï‡¶∞‡ßá ‡¶ï‡¶ø‡¶õ‡ßÅ add ‡¶ï‡¶∞‡ßÅ‡¶®‡•§' };
          return { status:'pass', detail:`Data size: ${(raw.length/1024).toFixed(1)} KB` };
        }
      },
      {
        name: 'Data valid JSON',
        desc: 'Data parse ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ',
        run: () => {
          try {
            const d = getAppData();
            if (!d) return { status:'fail', detail:'Data null ‡¶¨‡¶æ invalid JSON' };
            return { status:'pass', detail:'JSON valid ‚úì' };
          } catch(e) { return { status:'fail', detail:e.message }; }
        }
      },
      {
        name: 'students array',
        desc: 'Students array ‡¶Ü‡¶õ‡ßá ‡¶ì valid ‡¶ï‡¶ø‡¶®‡¶æ',
        run: () => {
          const d = getAppData();
          if (!d) return { status:'skip' };
          if (!Array.isArray(d.students)) return { status:'fail', detail:'students array ‡¶®‡ßá‡¶á' };
          return { status:'pass', detail:`${d.students.length} ‡¶ú‡¶® student ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá` };
        }
      },
      {
        name: 'finance array',
        desc: 'Finance transactions array valid ‡¶ï‡¶ø‡¶®‡¶æ',
        run: () => {
          const d = getAppData();
          if (!d) return { status:'skip' };
          if (!Array.isArray(d.finance)) return { status:'fail', detail:'finance array ‡¶®‡ßá‡¶á' };
          return { status:'pass', detail:`${d.finance.length}‡¶ü‡¶ø transaction ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá` };
        }
      },
      {
        name: 'employees array',
        desc: 'Employees array valid ‡¶ï‡¶ø‡¶®‡¶æ',
        run: () => {
          const d = getAppData();
          if (!d) return { status:'skip' };
          if (!Array.isArray(d.employees)) return { status:'warn', detail:'employees array ‡¶®‡ßá‡¶á (‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßá‡¶â ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá)' };
          return { status:'pass', detail:`${d.employees.length} ‡¶ú‡¶® employee` };
        }
      },
      {
        name: 'settings object',
        desc: 'Academy settings ‡¶∏‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ',
        run: () => {
          const d = getAppData();
          if (!d) return { status:'skip' };
          if (!d.settings || typeof d.settings !== 'object') return { status:'warn', detail:'settings object ‡¶®‡ßá‡¶á' };
          return { status:'pass', detail:`Academy: "${d.settings.academyName || '(not set)'}"` };
        }
      },
      {
        name: 'users array & admin',
        desc: 'Admin user ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ',
        run: () => {
          const d = getAppData();
          if (!d) return { status:'skip' };
          if (!Array.isArray(d.users) || d.users.length === 0) return { status:'warn', detail:'users array ‡¶ñ‡¶æ‡¶≤‡¶ø ‚Äî default admin ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá login ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá' };
          const admin = d.users.find(u => u.role === 'master' || u.username === 'admin');
          if (!admin) return { status:'warn', detail:`${d.users.length} ‡¶ú‡¶® user ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ master admin ‡¶®‡ßá‡¶á` };
          return { status:'pass', detail:`Admin: "${admin.username}"` };
        }
      },
    ]
  },
  {
    title: 'üì∏ Auto Snapshot System',
    tests: [
      {
        name: 'Snapshot key exists',
        desc: 'Auto snapshot system ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ',
        run: () => {
          const raw = localStorage.getItem(SNAPSHOT_KEY);
          if (!raw) return { status:'warn', detail:'‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã snapshot ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ App open ‡¶ï‡¶∞‡¶≤‡ßá ‡ß© ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ snapshot ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶¨‡ßá‡•§' };
          const snaps = JSON.parse(raw);
          return { status:'pass', detail:`${snaps.length}‡¶ü‡¶ø snapshot ‡¶Ü‡¶õ‡ßá` };
        }
      },
      {
        name: 'Snapshot count ‚â§ 7',
        desc: '‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß≠‡¶ü‡¶æ‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶®‡ßá‡¶á ‡¶ï‡¶ø‡¶®‡¶æ',
        run: () => {
          const raw = localStorage.getItem(SNAPSHOT_KEY);
          if (!raw) return { status:'skip' };
          const snaps = JSON.parse(raw);
          if (snaps.length > 7) return { status:'fail', detail:`${snaps.length}‡¶ü‡¶ø snapshot (‡ß≠‡¶ü‡¶æ‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø!)` };
          return { status:'pass', detail:`${snaps.length}/7 snapshots` };
        }
      },
      {
        name: 'Latest snapshot age',
        desc: '‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ snapshot ‡¶ï‡¶§‡¶ï‡ßç‡¶∑‡¶£ ‡¶Ü‡¶ó‡ßá ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ',
        run: () => {
          const raw = localStorage.getItem(SNAPSHOT_KEY);
          if (!raw) return { status:'skip' };
          const snaps = JSON.parse(raw);
          if (!snaps.length) return { status:'warn', detail:'‡¶ï‡ßã‡¶®‡ßã snapshot ‡¶®‡ßá‡¶á' };
          const ageMin = Math.round((Date.now() - snaps[0].id) / 60000);
          if (ageMin > 70) return { status:'warn', detail:`${ageMin} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ü‡¶ó‡ßá (‡ßß ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø)` };
          return { status:'pass', detail:`${ageMin} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ü‡¶ó‡ßá ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ` };
        }
      },
    ]
  },
  {
    title: 'üîß Core Functions',
    tests: [
      {
        name: 'renderLedger()',
        desc: 'Finance ledger render function',
        run: () => checkFn('renderLedger')
      },
      {
        name: '_handleDeleteTx()',
        desc: 'Finance transaction delete',
        run: () => checkFn('_handleDeleteTx')
      },
      {
        name: '_handleEditTx()',
        desc: 'Finance transaction edit',
        run: () => checkFn('_handleEditTx')
      },
      {
        name: 'exportData()',
        desc: 'Data backup/export',
        run: () => checkFn('exportData')
      },
      {
        name: 'importData()',
        desc: 'Data restore/import',
        run: () => checkFn('importData')
      },
      {
        name: 'saveToStorage()',
        desc: 'Data save function',
        run: () => checkFn('saveToStorage')
      },
      {
        name: 'showSuccessToast()',
        desc: 'Success notification',
        run: () => checkFn('showSuccessToast')
      },
      {
        name: 'updateGlobalStats()',
        desc: 'Dashboard stats update',
        run: () => checkFn('updateGlobalStats')
      },
      {
        name: 'takeSnapshot()',
        desc: 'Manual snapshot',
        run: () => checkFn('takeSnapshot')
      },
      {
        name: 'restoreSnapshot()',
        desc: 'Snapshot restore',
        run: () => checkFn('restoreSnapshot')
      },
      {
        name: 'deleteStudent()',
        desc: 'Student delete function',
        run: () => checkFn('deleteStudent')
      },
      {
        name: 'handleStudentSubmit()',
        desc: 'Student add/edit function',
        run: () => checkFn('handleStudentSubmit')
      },
      {
        name: 'renderAccountDetails()',
        desc: 'Account details modal render',
        run: () => checkFn('renderAccountDetails')
      },
    ]
  },
  {
    title: 'üåê Supabase Cloud Sync',
    tests: [
      {
        name: 'SUPABASE_CONFIG loaded',
        desc: 'Supabase config file load ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ',
        run: () => {
          if (typeof window.SUPABASE_CONFIG === 'undefined') return { status:'fail', detail:'supabase-config.js load ‡¶π‡¶Ø‡¶º‡¶®‡¶ø' };
          return { status:'pass', detail:`URL: ${window.SUPABASE_CONFIG.url.substring(0,30)}...` };
        }
      },
      {
        name: 'Supabase client',
        desc: 'Supabase JS client initialized ‡¶ï‡¶ø‡¶®‡¶æ',
        run: () => {
          if (typeof window.supabase === 'undefined' && typeof window.supabaseClient === 'undefined') {
            return { status:'warn', detail:'Supabase client ‡¶è‡¶á page-‡¶è ‡¶®‡ßá‡¶á (‡¶∂‡ßÅ‡¶ß‡ßÅ app.html-‡¶è ‡¶•‡¶æ‡¶ï‡ßá)' };
          }
          return { status:'pass', detail:'Supabase client ready' };
        }
      },
    ]
  },
  {
    title: 'üé® DOM Elements (App-‡¶è run ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá)',
    tests: [
      {
        name: 'ledgerTableBody',
        desc: 'Finance ledger table ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ',
        run: () => checkEl('ledgerTableBody')
      },
      {
        name: 'accountDetailsTableBody',
        desc: 'Account details table',
        run: () => checkEl('accountDetailsTableBody')
      },
      {
        name: 'settingsForm',
        desc: 'Settings form',
        run: () => checkEl('settingsForm')
      },
      {
        name: 'snapshotListContainer',
        desc: 'Snapshot list container',
        run: () => checkEl('snapshotListContainer')
      },
      {
        name: 'searchInput',
        desc: 'Search input field',
        run: () => checkEl('searchInput')
      },
    ]
  },
  {
    title: 'üìä Data Integrity',
    tests: [
      {
        name: 'Finance IDs unique',
        desc: '‡¶∏‡¶¨ transaction-‡¶è‡¶∞ unique ID ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ',
        run: () => {
          const d = getAppData();
          if (!d || !d.finance) return { status:'skip' };
          const ids = d.finance.map(f => f.id).filter(Boolean);
          const unique = new Set(ids);
          if (unique.size < ids.length) return { status:'warn', detail:`${ids.length - unique.size}‡¶ü‡¶ø duplicate ID ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá` };
          const noId = d.finance.filter(f => !f.id).length;
          if (noId > 0) return { status:'warn', detail:`${noId}‡¶ü‡¶ø transaction-‡¶è ID ‡¶®‡ßá‡¶á` };
          return { status:'pass', detail:`‡¶∏‡¶¨ ${ids.length}‡¶ü‡¶ø ID unique` };
        }
      },
      {
        name: 'Student IDs unique',
        desc: '‡¶∏‡¶¨ student-‡¶è‡¶∞ unique ID ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ',
        run: () => {
          const d = getAppData();
          if (!d || !d.students) return { status:'skip' };
          const ids = d.students.map(s => s.id).filter(Boolean);
          const unique = new Set(ids);
          if (unique.size < ids.length) return { status:'warn', detail:`${ids.length - unique.size}‡¶ü‡¶ø duplicate ID` };
          return { status:'pass', detail:`‡¶∏‡¶¨ ${ids.length}‡¶ü‡¶ø ID unique` };
        }
      },
      {
        name: 'Finance amounts valid',
        desc: '‡¶∏‡¶¨ amount ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶ï‡¶ø‡¶®‡¶æ',
        run: () => {
          const d = getAppData();
          if (!d || !d.finance) return { status:'skip' };
          const bad = d.finance.filter(f => isNaN(parseFloat(f.amount)));
          if (bad.length) return { status:'warn', detail:`${bad.length}‡¶ü‡¶ø transaction-‡¶è invalid amount` };
          return { status:'pass', detail:'‡¶∏‡¶¨ amount valid' };
        }
      },
      {
        name: 'LocalStorage size',
        desc: 'Storage size ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ ‡¶§‡ßã',
        run: () => {
          const raw = localStorage.getItem(APP_KEY) || '';
          const kb = raw.length / 1024;
          if (kb > 4500) return { status:'fail', detail:`${kb.toFixed(0)} KB ‚Äî limit-‡¶è‡¶∞ ‡¶ï‡¶æ‡¶õ‡¶æ‡¶ï‡¶æ‡¶õ‡¶ø! Backup ‡¶®‡¶ø‡¶®‡•§` };
          if (kb > 3000) return { status:'warn', detail:`${kb.toFixed(0)} KB ‚Äî ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá` };
          return { status:'pass', detail:`${kb.toFixed(1)} KB ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá` };
        }
      },
    ]
  },
];

function checkFn(name) {
  if (typeof window[name] === 'function') return { status:'pass', detail:`window.${name} ‚úì` };
  return { status:'fail', detail:`window.${name} ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø ‚Äî app.js ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá load ‡¶π‡¶Ø‡¶º‡¶®‡¶ø` };
}

function checkEl(id) {
  const el = document.getElementById(id);
  if (el) return { status:'pass', detail:`#${id} found` };
  return { status:'warn', detail:`#${id} ‡¶®‡ßá‡¶á ‚Äî ‡¶è‡¶á diagnostic tool App-‡¶è‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá run ‡¶ï‡¶∞‡ßÅ‡¶®` };
}

// ‚îÄ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function runAllTests() {
  passCount = 0; failCount = 0; warnCount = 0;
  logs = [];
  document.getElementById('logArea').innerHTML = '';
  document.getElementById('results').style.display = 'block';
  document.getElementById('sectionsContainer').innerHTML = '';
  document.getElementById('summaryBar').innerHTML = '';

  log('info', 'Diagnostic started...');

  TEST_SECTIONS.forEach((section, si) => {
    const sectionEl = document.createElement('div');
    sectionEl.className = 'section';

    let secPass = 0, secFail = 0, secWarn = 0;
    const rows = [];

    section.tests.forEach((test, ti) => {
      let result;
      try { result = test.run(); }
      catch(e) { result = { status:'fail', detail:'Error: ' + e.message }; }

      if (result.status === 'pass') { passCount++; secPass++; log('ok', `‚úì ${test.name}`); }
      else if (result.status === 'fail') { failCount++; secFail++; log('err', `‚úó ${test.name}: ${result.detail||''}`); }
      else if (result.status === 'warn') { warnCount++; secWarn++; log('warn', `‚ö† ${test.name}: ${result.detail||''}`); }
      else { log('info', `- ${test.name}: skipped`); }

      rows.push({ test, result });
    });

    const total = secPass + secFail + secWarn;
    const scoreColor = secFail > 0 ? '#ff4466' : secWarn > 0 ? '#ffcc00' : '#00ff88';

    sectionEl.innerHTML = `
      <div class="section-header" onclick="toggleSection(this)">
        <span class="section-title">${section.title}</span>
        <span class="section-score" style="color:${scoreColor}">
          ${secPass}‚úì ${secFail}‚úó ${secWarn}‚ö† / ${total}
        </span>
      </div>
      <div class="section-body">
        ${rows.map(({test, result}) => `
          <div class="test-row">
            <div>
              <div class="test-name">${test.name}</div>
            </div>
            <div class="test-desc">${result.detail || test.desc}</div>
            <div><span class="badge ${result.status}">${result.status.toUpperCase()}</span></div>
          </div>
        `).join('')}
      </div>
    `;

    document.getElementById('sectionsContainer').appendChild(sectionEl);
  });

  // Summary bar
  document.getElementById('summaryBar').innerHTML = `
    <div class="summary-item summary-pass">‚úÖ PASS: ${passCount}</div>
    <div class="summary-item summary-fail">‚ùå FAIL: ${failCount}</div>
    <div class="summary-item summary-warn">‚ö†Ô∏è WARN: ${warnCount}</div>
  `;

  const overall = failCount === 0 ? (warnCount === 0 ? '‚úÖ ‡¶∏‡¶¨ ‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá!' : '‚ö†Ô∏è ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ ‡¶Ü‡¶õ‡ßá') : '‚ùå ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá!';
  log('info', `Done. ${overall} (${passCount} pass, ${failCount} fail, ${warnCount} warn)`);
}

function toggleSection(header) {
  const body = header.nextElementSibling;
  body.classList.toggle('collapsed');
}
</script>
</body>
</html>
